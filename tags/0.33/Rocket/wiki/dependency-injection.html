<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<title>Dependency injection</title>
<link rel="stylesheet" type="text/css" href="stylesheet.css" />
</head>

<body>
<h1>Purpose</h1>
<p>
The purpose of the rocket.beans package is to offer the ability to DI beans on within a GWT clientside application.
Many but not all of the DI concepts made popular by Spring and other DI packages are supported.
</p>

<h1>Differences with Spring DI</h1>
<p>
The current beans package is just the start. More features (maybe including interceptors) that exist in Spring will eventually be copied.
</p>

<h2>Supported constructs</h2>
<p>
Not all spring concepts are supported. Many of the copied ideas use the same interfaces/names when possible.
</p>
<ul>
<li>Singleton / prototype scopes</li>
<li>FactoryBeans beans which create beans on demand</li>
<li>A custom (static) factory method</li>
<li>InitializingBean interface or a custom init method</li>
</ul>

<h2>Unsupported constructs</h2>
<ul>
<li>Intercepts are not supported - i am not sure how sensible it would be to support this.</li>
<li>Specifying a destroy method is not supported. Currently this lifecycle method is not supported.</li>
</ul>

<div class=".info">
It wouldnt be to hard to decorate pointcuts for a bean, but a performance hit could result. This will have to be investigated.
</div>

<div class=".info">
The possibility exists to call the custom destroy method for requested beans using <code>com.google.gwt.user.client.WindowCloseListener.onWindowClosing</code>
</div>

<h1>Getting started</h1>
<p>
The following steps below list what and why is needed to use this facility in your own development efforts.
</p>

<h2>Importing the rocket module</h2>
<p>
Add the rocket module to your own module.
</p>
<pre>
&lt;module name="Rocket.User" /&gt;
</pre>

<h2>Defining a custom bean factory</h2>
<p>
Create a new interface that extends <code>rocket.beans.client.BeanFactory</code>. It must not contain any methods.
</p>

<pre>
package example;

rocket.beans.client.BeanFactory

public ExampleBeanFactory extends BeanFactory{
	<b>// with no methods!</b>
}
</pre>

<h2>Creating the xml config file which defines all beans</h2>
<p>
Create a new xml file in the same directory (package) as the ExampleBeanFactory class. The name of the file should be <code>ExampleBeanFactory.xml</code>.
</pre>

<h2>Defining a Bean</h2>
<p>
The first bean below is for a class that contains only primitive properties.
All properties must have a public setter.
</p>

<h3>Declaring a bean with primitive properties</h3>
<pre>
package example;

public ClassWithOnlyPrimitiveProperties{
	private boolean foo;
	public void setFoo( boolean foo ){
		this.foo = foo;
	}

	private int bar;

	public void setBar( int bar ){
		this.bar = bar;
	}

	private String baz;

	public void setBaz( String baz ){
		this.baz = baz;
	}
}
</pre>

<p>
The beans xml block that creates and populates a singleton <code>example.ClassWithOnlyPrimitiveProperties</code>.
</p>

<pre>
	&lt;bean
		id="bean1"
		class="example.ClassWithOnlyPrimitiveProperties"
		scope="singleton"&gt;

		&lt;property name="foo"&gt;
			&lt;value&gt;true&lt;/value&gt;
		&lt;/property&gt;

		&lt;property name="bar"&gt;
			&lt;value&gt;123&lt;/value&gt;
		&lt;/property&gt;

		&lt;property name="baz"&gt;
			&lt;value&gt;"BazValue"&lt;/value&gt;
		&lt;/property&gt;
	&lt;/bean&gt;
</pre>

<p>
Any instances of <code>bean1</code> fetched from the bean factory or injected will have the three properties
populated.
</p>
<ul>
	<li>foo=true</li>
	<li>bar=123</li>
	<li>baz=BazValue</li>
</ul>
</p>


<h3>Declaring A bean with a reference to another bean</h3>
<p>
The example below creates a bean of type <code>example.ClassWhichReferencesAnotherBean</code> which also includes a reference
to the <code>example.ClassWithOnlyPrimitiveProperties</code> from above.
</p>
<pre>
package example;

public ClassWhichReferencesAnotherBean{
	private ClassWithOnlyPrimitiveProperties anotherBean;
	public void setFoo( ClassWithOnlyPrimitiveProperties anotherBean ){
		this.anotherBean = anotherBean;
	}
}
</pre>

<p>
The beans xml block that creates and populates a prototype <code>example.ClassWhichReferencesAnotherBean</code>..
Any instances of <code>bean2</code> will now also have a reference to bean1.
</p>

<pre>
	&lt;bean
		id="bean2"
		class="example.ClassWhichReferencesAnotherBean"
		scope="prototype"&gt;

		&lt;property name="anotherBean"&gt;
			&lt;bean-reference reference-id="bean1"/&gt;
		&lt;/property&gt;

	&lt;/bean&gt;
</pre>


<h1>Declaring Custom factory method</h3>
<p>
Rather than have the factory create new instances of a by simply invoking the no arguments constructor it is possible to specify a custom
method.
</p>

<pre>
	&lt;bean
		id="beanWithACustomFactoryMethod"
		class="example.BeanWithCustomFactoryMethod"
		scope="prototype"
		factoryMethod="create"&gt;
	&lt;/bean&gt;
</pre>

<p>
It is assumed that <code>example.BeanWithCustomFactoryMethod</code> includes a static method called create which returns new
<code>example.BeanWithCustomFactoryMethod</code> when asked.
</p>

<h1>Receiving initialized lifecycle events</h1>
<p>
Two options are available if a bean wishes to receive notification when it is ready after all its properties have been set.
Beans can implement the <code>rocket.beans.client.InitializingBean</code> or can specify a custom init method.
</p>


<h2>Custom init method</h2>
<p>
Rather than have the init create new instances of a by simply invoking the no arguments constructor it is possible to specify a custom
method.
</p>

<pre>
	&lt;bean
		id="beanWithACustomInitMethod"
		class="example.BeanWithCustomInitMethod"
		scope="prototype"
		initMethod="init"&gt;
	&lt;/bean&gt;
</pre>

<p>
It is assumed that <code>example.BeanWithCustomInitMethod</code> includes a public init method.
</p>


<h1>Further samples</h1>
<p>
For further examples refer to the unit tests <code>rocket.beans.test.client.BeansGwtTestCase (the main one)</code>.
</p>

</body>